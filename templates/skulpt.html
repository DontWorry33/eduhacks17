<html> 
<head> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script> 
<script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script> 

</head> 

<body> 

<script type="text/javascript"> 
// output functions are configurable.  This one just appends some text
// to a pre element.
function outf(text) {
    console.log("text in outf: "+text)
    var mypre = document.getElementById("hidden-output");
    mypre.innerHTML = mypre.innerHTML + text; 
}

function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
}

// Here's everything you need to run a python program in skulpt
// grab the code from your textarea
// get a reference to your pre element for output
// configure the output function
// call Sk.importMainWithBody()
function runit(ind) {
   console.log(ind)
   ind = parseInt(ind)
   var prog = document.getElementById("yourcode"+ind).value;
   var mypre = document.getElementById("hidden-output");
   console.log(prog);
   console.log({{ind}});
   console.log({{data.solutions | safe}})
   console.log({{data.questions | safe}})
   mypre.innerHTML = '';
   Sk.pre = "output"+ind;
   Sk.configure({output:outf, read:builtinRead}); 
   (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
   var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
   });
   myPromise.then(function(mod) {
       console.log('success');
   },
       function(err) {
       console.log(err.toString());
   });

   var outputVal = mypre.innerHTML
   document.getElementById("output"+ind).innerHTML = outputVal
   //outputVal = outputVal.replace(/\s/g, '')
   console.log(typeof(outputVal))
   solutionForQuestion = {{data.solutions | safe}}[ind]
   console.log(typeof(String(solutionForQuestion)))
   console.log("output sol: " + outputVal.replace(/\s/g, ''))
   console.log("real sol: " + String(solutionForQuestion).replace(/\s/g, ''))
   if (outputVal.replace(/\s/g, '') == String(solutionForQuestion).replace(/\s/g, '')) {
    alert("DUDE!");
   }
   //mypre.innerHTML = mypre.innerHTML + "<br> {{data.solution}}"

}

function showsol() {
    $('#expected_sol').text({{data.solution}})
}
</script> 

<h3>{{data.welcome}}</h3>
{% for x in data.questions %}
    <h4>{{data.questions[x]}}</h4>
    <textarea id="yourcode{{x}}" cols="40" rows="10"></textarea>
    <br />
<button type="button" onclick="runit({{x}})">Run</button>
    <button type="button" onclick="showsol()">Sol</button>
<pre id="output{{x}}" ></pre>
{% endfor %}



<div id="expected_sol"></div>
<!-- If you want turtle graphics include a canvas -->
<div id="mycanvas"></div> 

<div id="hidden-output" style="display: none;"> </div>

</body> 

</html> 